# LogBuddy Promtail Configuration Settings
# This file controls which logs are monitored and how they are processed.
# Generated by logbuddy config (promtail_conf_gen.py)

# Loki server URL (where to send logs)
loki_url: http://loki:3100/loki/api/v1/push

# Promtail settings
promtail_port: 9080
positions_file: /var/lib/promtail/positions.yaml
promtail_container: promtail
docker_command: podman  # or docker

# Log filtering by type
include_types:
  - openlitespeed
  - wordpress
  - php
  - mysql
  - cyberpanel

# Log filtering by service
include_services:
  - webserver
  - wordpress
  - database
  - script_handler

# Path patterns to include (regular expressions)
include_patterns:
  - '\.log$'
  - '/var/log/'
  - '/usr/local/lsws/'
  - '/home/.*/public_html/wp-content/debug\.log'

# Path patterns to exclude (regular expressions)
exclude_patterns:
  - '\.cache$'
  - '/tmp/'
  - 'debug_backup'
  - '\.(gz|zip|bz2)$'

# Log size limits (MB, 0 to disable)
max_log_size_mb: 100

# Name shortening (for better display in Grafana)
shorten_names: true
max_name_length: 40

# Log formats for different types (helps Loki parse timestamps correctly)
log_formats:
  openlitespeed:
    regex: '^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d+) \[(?P<level>[^\]]+)\] (?P<message>.*)$'
    timestamp_field: timestamp
    timestamp_format: '2006-01-02 15:04:05.000'

  wordpress:
    regex: '^\[(?P<timestamp>[^\]]+)\] (?P<level>\w+): (?P<message>.*)$'
    timestamp_field: timestamp
    timestamp_format: '02-Jan-2006 15:04:05'

  php:
    regex: '^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) (?P<message>.*)$'
    timestamp_field: timestamp
    timestamp_format: '2006-01-02 15:04:05'

  mysql:
    regex: '^(?P<timestamp>\d{6} \d{2}:\d{2}:\d{2}) (?P<message>.*)$'
    timestamp_field: timestamp
    timestamp_format: '060102 15:04:05'

# Pipeline stages for processing logs
pipeline_stages:
  openlitespeed:
    - regex:
        expression: '^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d+) \[(?P<level>[^\]]+)\] (?P<message>.*)$'
    - labels:
        level: ''
    - timestamp:
        source: timestamp
        format: '2006-01-02 15:04:05.000'

  wordpress:
    - regex:
        expression: '^\[(?P<timestamp>[^\]]+)\] (?P<level>\w+): (?P<message>.*)$'
    - labels:
        level: ''
    - timestamp:
        source: timestamp
        format: '02-Jan-2006 15:04:05'

# Advanced settings
relabel_configs:
  - source_labels: [__path__]
    target_label: path
  - source_labels: [job]
    target_label: app